<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta name="og:title" content="全ての投稿 - ぽんブログ" data-next-head=""/><meta property="og:type" content="website" data-next-head=""/><title data-next-head="">全ての投稿 - ぽんブログ</title><link rel="preload" href="/_next/static/css/88b30f8ffe8ac8ea.css" as="style"/><link rel="preload" href="/_next/static/css/598ca60572d926da.css" as="style"/><link rel="stylesheet" href="/_next/static/css/88b30f8ffe8ac8ea.css" data-n-g=""/><link rel="stylesheet" href="/_next/static/css/598ca60572d926da.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-8cac0b4b405cede1.js" defer=""></script><script src="/_next/static/chunks/framework-306aa0968ce8efc5.js" defer=""></script><script src="/_next/static/chunks/main-5472a3acfa376313.js" defer=""></script><script src="/_next/static/chunks/pages/_app-aaf6b887cfc00048.js" defer=""></script><script src="/_next/static/chunks/pages/posts-ce9ad23448e97706.js" defer=""></script><script src="/_next/static/n_dcOhZLlT1CFj-HBNtKQ/_buildManifest.js" defer=""></script><script src="/_next/static/n_dcOhZLlT1CFj-HBNtKQ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="_app_site__wQ_HZ"><header class="_app_heading__uRQQR"><a class="_app_brand__aiSQf" href="/">ぽんブログ</a></header><div class="_app_content__mHXSR"><div class="index_tabs__7yotL"><ul class="index_tab__JAwjV"><li><a class="index_tabItem__xHF3j index_selected__p__Ht" href="/posts">全部</a></li><li><a class="index_tabItem__xHF3j" href="/">ブログ</a></li><li><a class="index_tabItem__xHF3j" href="/diaries">日記</a></li></ul></div><div><article class="index_article__0_cD4"><a href="/posts/hhkb-jis-us"><div><h1 class="index_title__k0g7D">HHKBのJIS配列をUS配列としていい感じに使う</h1><p class="index_content__ROCt_">
[HHKB(JIS)をWindowsとMacの両方でいい感じに使う](/posts/hhkb-jis-win-mac) のおまけに書いてある通り今は HHKB の JIS 配列のものを US 配列として使っていますが、ある程度こなれてきてそのまま行こうかなとなったので書いておきます。

前提条件として、背面スイッチは全てオフの状態で使っています。  
&lt;https://happyhackingkb.com/jp/products/discontinued/hhkb_backview.html&gt;</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">HHKB</span></p><p class="index_published__SY0_x">2025-02-12</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/hhkb-jis-win-mac"><div><h1 class="index_title__k0g7D">HHKB(JIS)をWindowsとMacの両方でいい感じに使う</h1><p class="index_content__ROCt_">
普段 HHKB HYBRID の JIS 配列を使っていますが、macOS と Windows を同じデバイスで切り替えて使っていると、いくつか問題とは言えなくとも違和感を感じることがあります。

前提条件として、背面スイッチは全てオフの状態で使っています。  
&lt;https://happyhackingkb.com/jp/products/discontinued/hhkb_backview.html&gt;

- Windows の Ctrl 関連のショートカットは macOS では Cmd に</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">HHKB</span></p><p class="index_published__SY0_x">2024-12-25</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/rust-cross-compile"><div><h1 class="index_title__k0g7D">Rustのクロスコンパイルでハマった話</h1><p class="index_content__ROCt_">
[WebサービスをRustでフルリプレイスした話](/posts/smashfreaks-replace-with-rust) を書きましたが、途中で ECS Task の cpu_architecture を X86_64 から ARM に変更しています。（なんか Graviton2 がちょっと安いしちょっと性能がいいらしい）  
その際に GitHub Actions 上でクロスコンパイルをする必要があったのですが、それでハマったのでメモしておきます。  
ちなみにこれが本当に正しいのかよ</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">Rust</span></p><p class="index_published__SY0_x">2024-03-21</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/smashfreaks-replace-with-rust"><div><h1 class="index_title__k0g7D">WebサービスをRustでフルリプレイスした話</h1><p class="index_content__ROCt_">
個人で作ってた Web サービスを Rust で作り直したので、熱が冷めないうちに覚えてることを備忘録的に書いておこうと思います。  
いくつか本のリンクを貼ってますが、全て Amazon のアソシエイトリンクなのでそこが気になる人は検索して買ってください。

## どんなサービス？

どんなサービスかを軽く説明しておきます。  
&lt;https://smashfreaks.games&gt;  
SmashFreaks というスマブラ界隈の主にオフラインイベントで使われているサービスです。イベントに</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">Rust</span><span class="index_tag__fwpFk">個人開発</span></p><p class="index_published__SY0_x">2024-02-14</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/setup-mac-studio"><div><h1 class="index_title__k0g7D">Mac Studioを買ったのでセットアップした</h1><p class="index_content__ROCt_">
せっかく[Mac Studio](https://www.apple.com/jp/mac-studio/)を購入したので、セットアップ周りをメモとして書いとく。ちなみにApple Silicon機は2台目なので初見ではないです。

## ソフトウェア編

### SSH鍵

なんの鍵作っちゃおうかな〜〜と適当に調べていたらEdDSA鍵が出てきたので使うことにしました。
[GitHubで使うSSH鍵を生成 - くたくたじゅうよん](https://scrapbox.io/takker/GitH</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">Mac</span></p><p class="index_published__SY0_x">2022-05-04</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/add-images-to-my-blog2"><div><h1 class="index_title__k0g7D">ブログに画像を貼れるようにした〜その後〜</h1><p class="index_content__ROCt_">
[ブログに画像を貼れるようにした](/posts/add-images-to-my-blog) でブログに画像を貼れるようにしたけど、base64 で埋め込んでいたため少し問題があった。  
それを修正したのでこれも書いておく。

## 何が問題だったのか

base64 で埋め込んでいるため、テキストデータの量が画像によって多くなってしまう。
何が問題かと言うと、テキストデータを静的に HTML に入れているので、HTML ファイルの容量が大きくなってしまい、結果ページ読み込みの時間がかかる</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">TypeScript</span><span class="index_tag__fwpFk">Next.js</span><span class="index_tag__fwpFk">Blog</span></p><p class="index_published__SY0_x">2022-01-26</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/ididblog-droidkaigi2021"><div><h1 class="index_title__k0g7D">DroidKaigi 2021に参加した話</h1><p class="index_content__ROCt_">
[DroidKaigi 2021](https://droidkaigi.jp/2021/)に参加したので忘れないうちに書いておこうと思います。
業務では Android を主に書いていて、メインでガッツリ触っている技術のカンファレンスに参加するのは初めてになります。

## DroidKaigi 2021とは

&gt; DroidKaigiはエンジニアが主役のAndroidカンファレンスです。 Android技術情報の共有とコミュニケーションを目的に、2021年10月19日(火)、20日(水)、</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">Conference</span><span class="index_tag__fwpFk">Android</span></p><p class="index_published__SY0_x">2021-10-22</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/add-images-to-my-blog"><div><h1 class="index_title__k0g7D">ブログに画像を貼れるようにした</h1><p class="index_content__ROCt_">
※追記：その後実装を変えました [ブログに画像を貼れるようにした〜その後〜](/posts/add-images-to-my-blog2)

少しずつ弄ってるブログですが、この度画像を貼れるようにしました。

[![サンプル画像](./static/james-harrison-vpOeXr5wmR4-unsplash.jpg)](https://unsplash.com/photos/vpOeXr5wmR4)
ｼﾞｬｰﾝ

その時少しハマったので、ログを残しておきます。

## 使おうとした</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">TypeScript</span><span class="index_tag__fwpFk">Next.js</span><span class="index_tag__fwpFk">Blog</span></p><p class="index_published__SY0_x">2021-10-14</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/2021-10-14"><div><h1 class="index_title__k0g7D">2021年10月14日</h1><p class="index_content__ROCt_">
日記テスト
日記を実装した日
</p><div class="index_meta__6gj4Q"><p class="index_published__SY0_x">2021-10-14</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/ididblog-iosdcjapan2021"><div><h1 class="index_title__k0g7D">iOSDC Japan 2021に参加した話</h1><p class="index_content__ROCt_">
初の iOSDC Japan 参加記であり、初のカンファレンス参加記です。 :tada: [iOSDC Japan 2021](https://iosdc.jp/2021/)
iOSDC Japan に関しては 2020 から参加しており、主催（実行委員長？）の方が同じ PHPerKaigi では 2019 から毎年参加しています。
いつも iwillblog を無視し続けている感じになっていたので、今回こそは！！！という感じです。

ということで書く為にこのブログを[作りました](/post</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">Conference</span><span class="index_tag__fwpFk">iOS</span></p><p class="index_published__SY0_x">2021-09-21</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/create-a-blog"><div><h1 class="index_title__k0g7D">ブログを作った話</h1><p class="index_content__ROCt_">
この前 [iOSDC Japan 2021](https://iosdc.jp/2021/) というカンファレンスに参加しました。そこで出てくるキーワードとして「iwillblog」というものがあります。
意味は見ての通りで「私はブログを書きます」で、それを見るたびに書くか！と思いますが、今まで書いたことがありません。
同じようなカンファレンスは何度か参加していますが、毎回そんな感じです。

個人的に書くモチベがある場所があまりなく、書きたいなと思っているうちに月日が流れ・・・。という感じ。
</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">TypeScript</span><span class="index_tag__fwpFk">Next.js</span><span class="index_tag__fwpFk">Blog</span></p><p class="index_published__SY0_x">2021-09-21</p></div></div></a></article><article class="index_article__0_cD4"><a href="/posts/hello-world"><div><h1 class="index_title__k0g7D">Hello World!</h1><p class="index_content__ROCt_">
内容はないよう
</p><div class="index_meta__6gj4Q"><p class="index_tags__lwo_l"><span class="index_tag__fwpFk">test</span></p><p class="index_published__SY0_x">2021-09-19</p></div></div></a></article></div></div><footer class="_app_footer___uvS6"><div class="_app_link__Y_6XC"><a href="/privacy-policy">プライバシーポリシー</a><a href="/disclaimer">免責事項</a></div><div>© 2021<!-- --> <a target="_blank" href="https://twitter.com/pon_dev">Pon</a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"content":"\n[HHKB(JIS)をWindowsとMacの両方でいい感じに使う](/posts/hhkb-jis-win-mac) のおまけに書いてある通り今は HHKB の JIS 配列のものを US 配列として使っていますが、ある程度こなれてきてそのまま行こうかなとなったので書いておきます。\n\n前提条件として、背面スイッチは全てオフの状態で使っています。  \n\u003chttps://happyhackingkb.com/jp/products/discontinued/hhkb_backview.html\u003e\n\n## HHKB のキーマップ変更\n\nHHKB は公式でキーマップ変更ツールが用意されているので、それを使って設定します。  \n\u003chttps://happyhackingkb.com/jp/download/\u003e\n\nJIS 配列の HHKB ではそのままだと US 配列にしても反応しないキーがあり使えなかったりするので、それを変更します。\n\n![keymap-before](./static/hhkb-jis-us-keymap-before.png)\n\n↓\n\n![keymap-after](./static/hhkb-jis-us-keymap-after.png)\n\nCtrl R と Cmd に関しては [HHKB(JIS)をWindowsとMacの両方でいい感じに使う](/posts/hhkb-jis-win-mac) で設定した通りで変更ありません。こちらは Windows で使わないのであれば気にしなくて良いと思います。\n\nさて、重要なのは右上の `¥` と `|` のキーです。これは US 配列としてそのまま使うと何も反応しません。なので、US で同じ位置にある `` ` `` と `~` を使うために変更します。（本来は BS の位置にありますが、エンターキー周りの配列の影響で一つ左の位置で入力できるようにします。）  \nJIS でいうところの特殊ロゴ（記号）キーを設定すると、US 配列では `` ` `` と `~` になります。  \nちなみに、特殊ロゴキーは [公式ヘルプ](https://faq.pfu.jp/faq/show/2643?site_domain=hhkb) によると Windows は 半角/全角、macOS は Caps らしいです。使ってなかったので知らなかった。  \n\n↑ の左にある Shift R に関しては余っていたので適当に置いています。矢印キーも US にはないのでここら辺も US そのまんまとは少し違いますね。本来の Shift R を Fn にして〜等をすると US に近づくかもしれないですが、今まで JIS で使っていた自分には違和感がすごいのでここは変更していません。\n\n## Windows での設定\n\nWindows で HHKB(JIS) を US として繋ぐと無変換キーと変換キーの位置のキーが反応しないため、それを使えるように設定します。\n\nまずはキーボードレイアウトを US にするのを忘れずに。設定 \u003e 時刻と言語 \u003e 言語と地域 \u003e 日本語の言語のオプション でキーボードのレイアウトを「英語キーボード (101/102 キー)」に変更します。\n\n![win-keyboard-layout](./static/hhkb-jis-us-win-keyboard-layout.png)\n\n次は [PowerToys](https://learn.microsoft.com/ja-jp/windows/powertoys/) を使って反応しないキーを使えるように設定します。[PowerToys](https://learn.microsoft.com/ja-jp/windows/powertoys/) は Microsoft 公式の色々設定できるくんで、その中に Keyboad Manager があるのでそれで設定します。\n\n変更内容は以下の通りです。\n\n- VK 235 -\u003e IME Off\n- Undefined -\u003e IME On\n\n[PowerToys](https://learn.microsoft.com/ja-jp/windows/powertoys/) では割り当て変更の対象キーを押すことによって変更元を判定できるため、変更元の名前は特に気にしなくても大丈夫です。（Undefined とかなってるけどしっかり反応します）  \nあと、自分は IME On/Off が好きなのでそうしていますが、お好みで Windows デフォルトの無変換と変換に割り当ててもいいと思います。\n\n![powertoys](./static/hhkb-jis-us-powertoys.png)\n\n## macOS での設定\n\nMacBook についているキーボードも JIS のものを使っていて、HHKB と同じ感じにしたいなーということで Karabiner-Elements を使って **MacBook についているキーボード** の設定を一部変更しています。\n\nまず、Virtual Keyboard で JIS から ANSI に変更しないと JIS として認識されてしまう問題があったので、これを変更しています。\n\n![karabiner-virtual-keyboard](./static/hhkb-jis-us-karabiner-virtual-keyboard.png)\n\nそして、HHKB のキーマップ変更と同様 JIS の `¥` と `|` の場所が使えないので MacBook のキーボードでもそれが使えるように設定します。\n\n- international3 -\u003e grave_accent_and_tilde(`)\n\n![karabiner](./static/hhkb-jis-us-karabiner.png)\n\nHHKB の方は [HHKB(JIS)をWindowsとMacの両方でいい感じに使う](/posts/hhkb-jis-win-mac) で設定した内容と同じなので気にしなくて大丈夫です。\n\n## おわり\n\nこれで HHKB の JIS 配列を使っている人がそのままそれを US 配列として使っても違和感なく使える設定ができました。Linux にそのまま繋いでも問題なく使えるかは分からないです。もし試してみたい人は試してみてください。\n","slug":"hhkb-jis-us","title":"HHKBのJIS配列をUS配列としていい感じに使う","published":"2025-02-12","publishedIndex":0,"tags":["HHKB"],"fileName":"hhkb-jis-us","staticFiles":["hhkb-jis-us-karabiner-virtual-keyboard.png","hhkb-jis-us-karabiner.png","hhkb-jis-us-keymap-after.png","hhkb-jis-us-keymap-before.png","hhkb-jis-us-powertoys.png","hhkb-jis-us-win-keyboard-layout.png"]},{"content":"\n普段 HHKB HYBRID の JIS 配列を使っていますが、macOS と Windows を同じデバイスで切り替えて使っていると、いくつか問題とは言えなくとも違和感を感じることがあります。\n\n前提条件として、背面スイッチは全てオフの状態で使っています。  \n\u003chttps://happyhackingkb.com/jp/products/discontinued/hhkb_backview.html\u003e\n\n- Windows の Ctrl 関連のショートカットは macOS では Cmd になる。\n  - ついでに macOS の Cmd は Windows では Win キーになる。\n- スペースの両横にあるキーは Windows では無変換と変換だが、macOS だとそもそも使えない。（Windows モードの場合）\n\nこれらは問題とは言えませんが、頻繁に切り替えて使っているとそれなりにストレスになります。また、Windows モードと Macintosh モードをキーで切り替えることも可能ですが、変更したかどうかに脳のリソースを持っていかれるため避けたいです。  \nそこで、それらをいい感じに解消できる設定をしばらく使っていたので、その設定を備忘録として残しておきます。\n\n## HHKB のキーマップ変更\n\nHHKB は公式でキーマップ変更ツールが用意されているので、それを使って設定します。  \n\u003chttps://happyhackingkb.com/jp/download/\u003e\n\nWindows と macOS で Ctrl と Cmd がいい感じに対応するように設定します。  \nmacOS でいつもの位置で Cmd を使え、Windows でも macOS と同じ位置で Ctrl を使えるようにしたいです。そこで、Cmd を一つ左にずらして、元の Cmd の位置に右側の Ctrl を割り当てます。この際 Windows での 半角/全角 キーは捨てます。\n\n![keymap-before](./static/hhkb-keymap-before.png)\n\n↓\n\n![keymap-after](./static/hhkb-keymap-after.png)\n\nこの変更をして、macOS 側では Ctrl R を Cmd に割り当てることにします。なぜ Ctrl R なのかというのは macOS での設定で説明します。\n\n## Windows での設定 （お好み）\n\n無変換・変換キーの位置は macOS ではかな・英数キーになっていて、macOS では変換ボタンの役割はなく IME のオンオフなので、Windows もそれに合わせます。\n\n設定 \u003e 時刻と言語 \u003e 言語と地域 \u003e 日本語の言語のオプション \u003e Microsoft IME のキーボードオプション \u003e キータッチのカスタマイズ でキーの割り当てを変更します。\n\n- 無変換キー -\u003e IME-オフ\n- 変換キー -\u003e IME-オン\n\n![windows-ime](./static/windows-ime.png)\n\n## macOS での設定\n\nこのままではかな・英数キーが使えないため、Karabiner-Elements を使って設定します。  \n\u003chttps://karabiner-elements.pqrs.org/\u003e\n\nまず、かな英数キーを使えるように設定します。  \n\n- PC キーボードの無変換キー -\u003e 英数キー\n- PC キーボードの変換キー -\u003e かなキー\n\n![karabiner-ime](./static/hhkb-karabiner-ime.png)\n\n次に、Ctrl R を Cmd に割り当てます。この際 Control を設定してしまうと左側の Control キーも使えなくなってしまうため、右側の Control キー（Ctrl R）を割り当てることで回避しています。\n\nそして、最終的にはこうなります。\n\n![karabiner](./static/hhkb-karabiner.png)\n\nこれで、HHKB を Windows と macOS で切り替えてもそのまま使えるように設定できました。一般的な Windows で使う JIS 配列のキーボードとは少しだけ違いますが、HHKB としてはどちらでもほぼそのまま使えると思います。\n\n## おまけ\n\n実は今は HHKB の JIS 配列のものを US 配列として使ってみています。（だから忘れないうちにこの記事を書いた）  \nこれは色々試してみている段階で、慣れてきて使っていこうとなったらまた設定を残しておこうと思います。\n","slug":"hhkb-jis-win-mac","title":"HHKB(JIS)をWindowsとMacの両方でいい感じに使う","published":"2024-12-25","publishedIndex":0,"tags":["HHKB"],"fileName":"hhkb-jis-win-mac","staticFiles":["hhkb-karabiner-ime.png","hhkb-karabiner.png","hhkb-keymap-after.png","hhkb-keymap-before.png","windows-ime.png"]},{"content":"\n[WebサービスをRustでフルリプレイスした話](/posts/smashfreaks-replace-with-rust) を書きましたが、途中で ECS Task の cpu_architecture を X86_64 から ARM に変更しています。（なんか Graviton2 がちょっと安いしちょっと性能がいいらしい）  \nその際に GitHub Actions 上でクロスコンパイルをする必要があったのですが、それでハマったのでメモしておきます。  \nちなみにこれが本当に正しいのかよくわかってないので、別の良い方法があるかもしれません。\n\n## 前提\n\n- この Rust プロジェクトは axum で作られた Web アプリケーションです。\n- GitHub Actions 上でビルドされ、AWS ECS にデプロイされます。\n- GitHub Actions では ubuntu-latest を使っていて、これは現状 x86_64 です。（[Accelerate your CI/CD with Arm-based hosted runners in GitHub Actions - The GitHub Blog](https://github.blog/changelog/2023-10-30-accelerate-your-ci-cd-with-arm-based-hosted-runners-in-github-actions/) によるともうすぐ使えるようになるかもしれない）\n- 実行コンテナイメージは `gcr.io/distroless/cc-debian12` です。\n\n## まず何をやったか\n\n一番楽な方法をまず試します。  \n`docker/build-push-action` を使って Docker イメージをビルドしているので、これに `platforms: linux/arm64` を追加してみました。すると・・・？\n\n![Before](./static/cross-compile-before.png)\n\n脅威の Billable time **5h 10m**！  \n\n## 何が問題だったか\n\nDocker のビルドで実行ホストと違うプラットフォーム用のコンテナのビルドには QEMU エミュレーションが使われるらしいのですが、これがどうも遅いらしいです。\n\n## どう解決したか\n\nRust のクロスコンパイルを使うことにしました。しかし調べてすぐ出てくるような方法ではイマイチうまく解決できませんでした。最終的には色々なところからちょっとずつ拾ってきて試したところ動くようになりました。\n\n```shell\napt-get install g++-aarch64-linux-gnu\nCARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER=\"aarch64-linux-gnu-gcc\"\nCC_aarch64_unknown_linux_gnu=\"aarch64-linux-gnu-gcc\"\nCXX_aarch64_unknown_linux_gnu=\"aarch64-linux-gnu-g++\"\n```\n\n\u003e \u003chttps://kerkour.com/rust-cross-compilation\u003e\n\n```shell\ndpkg --add-architecture arm64\napt-get install libssl-dev:arm64\n```\n\n\u003e \u003chttps://fltk-rs.github.io/fltk-book/Cross-Compiling.html#x64-linux-gnu-to-aarch64-linux-gnu\u003e\n\n```shell\nPKG_CONFIG_SYSROOT_DIR=\"/usr/aarch64-linux-gnu/\"\n```\n\n\u003e \u003chttps://stackoverflow.com/questions/68871193/pkg-config-error-during-rust-cross-compilation\u003e\n\nこれらを Dockerfile に追加してビルドしました。すると・・・？\n\n![After](./static/cross-compile-after.png)\n\nBillable time **22m**！\n\n## 結果\n\n嬉しい（なんか変なところとかこうした方がいいみたいなのがあったらよければ教えてください）\n","slug":"rust-cross-compile","title":"Rustのクロスコンパイルでハマった話","published":"2024-03-21","publishedIndex":0,"tags":["Rust"],"fileName":"rust-cross-compile","staticFiles":["cross-compile-after.png","cross-compile-before.png"]},{"content":"\n個人で作ってた Web サービスを Rust で作り直したので、熱が冷めないうちに覚えてることを備忘録的に書いておこうと思います。  \nいくつか本のリンクを貼ってますが、全て Amazon のアソシエイトリンクなのでそこが気になる人は検索して買ってください。\n\n## どんなサービス？\n\nどんなサービスかを軽く説明しておきます。  \n\u003chttps://smashfreaks.games\u003e  \nSmashFreaks というスマブラ界隈の主にオフラインイベントで使われているサービスです。イベントに参加しているユーザー同士が1対1でマッチングをし、対戦するモニターを自動で割り当てます。対戦後に結果報告をすることでレート計算が行われます。  \n全てユーザーの操作に依存しているため、特別な管理作業以外の運営作業がほとんど発生せず、イベントスタッフも対戦に参加することができます。  \n2019年7月にリリースされ、4年半くらいのサービスです。  \n\u003chttps://smashlog.games/9818\u003e\n\n## なぜ作り直すのか\n\nSmashFreaks は元々 PHP の [Laravel](https://laravel.com) 製で、当時新卒1年目の配属が決まった頃くらいに開発期間1ヶ月ほどでリリースしました。特に何も考えずに作っていたのでこの世の全てを Controller に書き、テストは存在せず、Eloquent のモデルを直接あれこれするみたいな感じでした。  \nその後すぐ新型コロナのあれこれでオフラインイベントが無くなり殆ど使われなくなってドメイン代とサーバー代だけ払ってました。何回か途中でリファクタリングをしようとするもモチベ続かずに途中で止まるみたいなことをしてました。  \n新型コロナが出始めてからしばらく経った後に、オフラインイベントが復活してきたあたりで使ってくれるところが徐々に増えてきました。サイトの出来に満足いってなかった自分は「これはなんとかしないといかん！」と触ろうとするんですが、「これこのコードの改善と作り直しの時間ほとんど変わらなさそうじゃね？」みたいな感じに思ったので作り直すことにしました。\n\n## 作り直し時の判断\n\n自分は Web サービスは PHP でしか作ったことがありませんでした。インフラもアルバイトで多少の構築経験を得られたくらいで、それまではレンタルサーバーにポン置きだったため、殆ど知識はありません。  \n今回も PHP で作り直そうとしており、[BEAR.Sunday](https://bearsunday.github.io/manuals/1.0/ja/) を触ってみたりとかフロントに [Next.js](https://nextjs.org) を触ってみたりとかしたんですが、結局全然作りませんでした。（ログインぐらいは作ってみた）  \n結果選択したのは Rust でした。Rust は触りたいなという興味があってほんの少し触っていたこと（フレンドに頼まれた Discord bot の作成とか）、[kenkooooさん](https://twitter.com/kenkoooo)の発信等で Rust でも Web バックエンドいけるらしいという情報があったのでまあやってみるか〜と Rust を選びました。パフォーマンスがどーとかそういうのは選定理由に入ってません。規模が全然大きくない個人開発サービスですしね。\nDB のデータだけ dump してきて、そこから作りながらマイグレーションを書いていくみたいな感じで進めることにしました。作り直して触れるようになる（触るモチベが出るようになる）のが目的ですが、明らかに気になるところや要望をもらっているところは新機能実装や修正をしました。\n\n## 開発期間\n\nリポジトリは作ったのが2022年7月でなので1年半くらい。途中全く触らなかったりとかもあり実際にもりもり書き始めたのが2023年の9月くらいなんで、稼働したのは半年くらい？  \nなんかちょうど筆乗り始め時期に[iOSDC Japan 2022](https://iosdc.jp/2022/)と[2023](https://iosdc.jp/2023/)があって、両方とも会場で休憩時間にちょっと書いていた記憶がありますね。\n\n![Contribution](./static/contribution.png)\n\n## 構成\n\n### インフラ\n\nAWS を使っています。今まで自分は前述の通りレンタルサーバーにポン置きした PHP という構成で公開しかしてなかったです。流石にそろそろ他の方法触っておくか・・・みたいな気持ちもあり、今流行り（遅い）のクラウドや！ということで AWS を使ってみることにしました。\n\n構成はよくある CloudFront -\u003e ALB -\u003e ECS Fargate -\u003e RDS(MariaDB), ElastiCache(Redis) です。  \n\n![SmashFreaks AWS 構成図](./static/smashfreaks-aws.png)\n\nさらっと構成図を書いてみました。コンテナは public subnet においてます。ログインに外部サービスを使うためアウトバウンドが必要で、 NAT Gateway とか VPC Endpoint とかが高かったので、Security Group に頑張ってもらって・・・。  \nこれらは Terraform で定義ファイルを作り、apply でいつでも同じものが作れるようにしています。  \n\nなんもわからんの状態で作ってみるのはこの本が役に立ちました。ちなみにこの本はスマブラのフレンドから教えてもらいました。\n\n[Amazon Web Services基礎からのネットワーク＆サーバー構築改訂](https://amzn.to/3HYNEDW)\n\nまずこの本を参考に手動で Web UI 上で構築してみて動くことを確認した後、[Terraform CLI の Import 機能](https://developer.hashicorp.com/terraform/cli/import) を使って1個1個 import してみて Terraform の構成ファイルに落とし込みました。\n\n#### bastion\n\n本番の RDS に繋ぎたくなった時のために bastion という ECS Service を作っています。実態は [amazon-ssm-agent/amazon-ssm-agent](https://gallery.ecr.aws/amazon-ssm-agent/amazon-ssm-agent) というイメージです。AWS CLI の Session Manager を使ってローカルの好きなポートにポートフォワードして RDS に繋げるようにしています。通常時は必要なタスクを0にして無駄な課金が発生しないようにしていて、必要な時だけタスクを立ち上げるようにしています。\n\n### アプリケーション\n\nRust の [axum](https://github.com/tokio-rs/axum) というフレームワークを使っています。非同期ランタイムが〜とかパフォーマンスが〜とかはあんまよくわかんないですが、[tokio](https://tokio.rs) が作ってるのですぐ潰れることはないだろうみたいな安易な考えで採用しました。悪い話も聞かないし触っててもいい感じがするので良かったと思います。他にも [Actix](https://actix.rs) は本を読んで少し触ってみたりしました。  \n読んだ本はこちら -\u003e [実践Rustプログラミング入門](https://amzn.to/3SVdrTs)\n\nRust はランタイムエラーが少ないな〜というところが気に入っており、今回書いたコードでランタイムエラーが出る時は基本的に OAuth とかでレスポンスが意図していない時、DB 周りで変なコードを書いた時、DB 等に接続できなかった時くらいです。それ以外は意図したエラーでハンドリングできています。  \n（ちなみに他の言語でも出ないように書けるとかはあると思いますが、特に意図していないけどそうなったところも気に入りポイントです。）\n\n#### Askama\n\n[djc/askama: Type-safe, compiled Jinja-like templates for Rust](https://github.com/djc/askama)\n\nテンプレートエンジンには [Askama](https://github.com/djc/askama) を使っています。[Tera](https://github.com/Keats/tera) を最初使っていましたが、コンパイル時に問題が分からないのでそこが不満に感じてました。[Askama](https://github.com/djc/askama) はコンパイル時に問題がわかるので最高になりました。VSCode で書いているので拡張とかは無くて、若干どこで問題が発生しているのかが分からない時があります。まあエラーログを見れば大体わかりますが・・・パフォーマンスもなんかそこそこいいらしいです。[Tera](https://github.com/Keats/tera) はその都度外に置いてあるテンプレートファイルを読むみたいな感じ（多分）だったと思いますが、[Askama](https://github.com/djc/askama) は生成されるシングルバイナリに含まれるみたいな感じになります。\n\n#### SeaORM\n\nDB 周りには [SeaORM](https://www.sea-ql.org/SeaORM/) という ORM を使ってます。最初は [sqlx](https://github.com/jmoiron/sqlx) を使っていました。使ってみたかった理由はなんとなくですが（またか）、[sqlx](https://github.com/jmoiron/sqlx) はコンパイル時に SQL がおかしそうなことがわかる macro があったりしてちょっと羨ましさを感じます。ちょいちょいランタイムエラーで気がつくことがあります。どうするのがバランスいいんだろう・・・\n\n#### tower-sessions\n\n[maxcountryman/tower-sessions: 🥠 Sessions as a \\`tower\\` and \\`axum\\` middleware.](https://github.com/maxcountryman/tower-sessions)\n\nセッション管理にはこの crate を使っています。同作者の [axum-login](https://github.com/maxcountryman/axum-login) という crate も便利そうだな〜と思いつつ、そっちは middleware を作ったりして自前でやってたので一旦は使ってません。試してみて良さそうだったら使ってみるかも。\n\n#### OAuth2\n\n[ramosbugs/oauth2-rs: Extensible, strongly-typed Rust OAuth2 client library](https://github.com/ramosbugs/oauth2-rs)\n\nアカウント認証周りにはこの crate を使っています。OAuth2 に対応しているサービスであれば簡単に使えたのでよかったです。\n\n### 開発環境\n\n開発環境用の Dockerfile を書いて DevContainer を使って VSCode で開発しています。\n\n#### mold\n\n[rui314/mold: Mold: A Modern Linker 🦠](https://github.com/rui314/mold)\n\nリンカーに [mold](https://github.com/rui314/mold) というものを使っています。[cargo-watch](https://crates.io/crates/cargo-watch) を使って保存するたびにコンパイルが走るみたいな感じにしてるんですが、露骨にスピードアップを感じます。おすすめ。\n\n#### OrbStack\n\nDocker コンテナ環境は [OrbStack](https://orbstack.dev) というのを使っています。最初は [Docker Desktop](https://www.docker.com/products/docker-desktop/) を使っていて全然不満なかったんですが、[OrbStack](https://orbstack.dev) にしたら立ち上げがすごい早くなりました。コンパイル自体も多少速かったです。DevContainer は何もせずそのまま使えたので、同じような環境の方にはおすすめです。\n\n### CI / CD\n\nGitHub Actions でデプロイまで自動でやってます。使っているワークフローは以下。\n\n- main\n- pr\n- tagpr\n- cache_for_deploy\n- deploy\n\nそれぞれについて書いていきます。\n\n#### main\n\nmain ブランチにマージされた時に動きます。テストだけ動かしてます。  \n[Swatinem/rust-cache](https://github.com/Swatinem/rust-cache) を使っています。\n\n#### pr\n\nPull Request が作られた時や、コミットが更新された時に動きます。まず [dorny/paths-filter](https://github.com/dorny/paths-filter) を使ってファイルの変更をチェックし、Rust に関係するコードに変更がなければスキップします。  \ntest のほか、fmt や clippy を動かしています。[Swatinem/rust-cache](https://github.com/Swatinem/rust-cache) を使ってビルド \u0026 キャッシュした後、それを使って test, fmt, clippy が動くようにしています。  \nfmt や clippy で何かあった時には Pull Request にコメントを書いてくれます。\n\n#### tagpr\n\n[Songmu/tagpr](https://github.com/Songmu/tagpr) を動かすワークフローです。main ブランチにマージされた時や、tagpr によって作られた Pull Request のラベルに変更があった時に動くようにしています。これは後から tagpr:minor とかをつけたくなった時用です。tagpr は動いた後に main ブランチに変更があれば自動で Pull Request が作られます。その Pull Request をマージするとタイトルのバージョンタグが切られ、そのタグの Release が publish されます。  \nこれめちゃくちゃ最高なのでおすすめです。自分は後述のワークフローと組み合わせてかなり満足度高いリリースフローが作れました。  semver の minor とかは現状は特に意味もないので気分で適当に決めてます。\n\n#### cache_for_deploy\n\nmain ブランチに tagpr によって作られたブランチがマージされた時に動きます。デプロイのための Docker イメージをビルドします。main ブランチでキャッシュを作らないと読めない仕様があるみたいで、後述する deploy は Release が publish された時に動きます。Release の publish をトリガーとするワークフローでは確かキャッシュが共有できなかったため、ビルドのためのキャッシュは main ブランチに紐づいているここでやってます。  \nDockerfile 内では [cargo-chef](https://github.com/LukeMathWalker/cargo-chef) を使ってレイヤーキャッシュが効くようにしています。\n\n#### deploy\n\ntagpr によって Release が publish された時に動きます。（手動 publish でも動く）  \n`cache_for_deploy` が終わってから動いて欲しいため、concurrency で `cache_for_deploy` と同じ group を設定しています。  \ncancel-in-progress は false。`cache_for_deploy` が終わってからだとビルドにかかる時間は10秒以内なのでほぼ無しです。デプロイ時間だけ。  \nここでは二つデプロイしています。App 本体と、DB マイグレーションです。\n\n軽い手順を話すと、App では\n\n\u003e イメージをビルドして ECR にプッシュ -\u003e [aws-actions/amazon-ecs-render-task-definition](https://github.com/aws-actions/amazon-ecs-render-task-definition) でタスク定義を更新 -\u003e [aws-actions/amazon-ecs-deploy-task-definition](https://github.com/aws-actions/amazon-ecs-deploy-task-definition) でタスク定義をデプロイ\n\nDB マイグレーションは ECS のクラスターでタスクとして動かしているので\n\n\u003e イメージをビルドして ECR にプッシュ -\u003e [aws-actions/amazon-ecs-render-task-definition](https://github.com/aws-actions/amazon-ecs-render-task-definition) でタスク定義を更新 -\u003e `aws ecs run-task` コマンドでタスクを実行\n\nという感じにしています。（こっちはもっといい方法ありそう？）\n\n#### Renovate\n\nバージョンアップには [Renovate](https://www.mend.io/renovate/) を使ってます。勝手に Pull Request を作ってくれるので便利です。開発環境用の Dockerfile では [mold](https://github.com/rui314/mold) のコンパイルや [cargo-watch](https://crates.io/crates/cargo-watch) 等の install をしているんですが、それのバージョン更新だけ拾えなかったので `regexManagers` で拾えるように設定してます。\n\n## リリース\n\nまずはサブドメインを作ってその上でオフラインイベント運営の方に協力を得てテストイベントを開催しました。そこで特に問題なく動いてました。  \n後はテストイベントを積み重ねるか、えいやでリリースするかで、めんどくさくなってえいやでリリース日を決めてリリースしましたw  \nリリース日の後に使われる中では最大規模のイベントで使われることがわかっており、そこである程度バグは出るかな・・・みたいな。  \n実際進行不能バグはなかったものの、マッチングロジックにおけるバグはいくつかあり、修正をデプロイしまくりました。進行不能バグはなかったので大成功でした。（元々のプログラムの方にも普通にバグはあったので）  \n一応リリース後1週間ぐらいはそれなりに監視をしてバグがあったら直す生活をしました。\n\n### 負荷の感じ\n\nスペックよくわからないんで全て最低でリリースしてます。ECS Fargate の CPU は LINUX/ARM64 の 0.25vCPU、 メモリは 512MB です。RDS とか ElastiCache は t4g.micro です。  \n負荷を見ていると、メモリ使用率は常に2%以下。CPU使用率も高い時で36%くらいでした。大丈夫そう。  \n高い時というのは最大規模のイベントで使われた日で、サイト内での総参加者数が214人が1つ、29人が1つ、14人が1つの計3つのイベントで同じ時間に使われていました。  \n戦っている人がいたり帰ってたり休憩してたりそもそもやってなかったりする人がいるので同時に214人+29人+14人が常に触っているわけでは全然ないんですが、それでも結構余裕な感じでしたね。一応オートスケールの設定は入れてました。\n\n![Metrics](./static/metrics.png)\n\nグラフではメモリが3%までいってるんですが、無駄なキャッシュをしていてほぼ意味ないところだったので後に消しています。消した後は2%以下安定してますね。（メモリの0になってるところはデプロイしているところで、5回くらいデプロイしたらしい。）\n\nちなみに PHP の時は1000円くらいのサーバーを借りてたんですが、ふと気になって過去の CPU 使用率を見てみたら高くても2%でした。 (2Core 1GB)  \nメモリ使用率は6%までいってた時があったんで、メモリ使用量は明確に減ってそう。CPU 使用率は元々低いのでよくわからない。  \n\n### Rust の感想\n\n開発環境周りも含め書いていてかなり気持ちがいいです。clippy とかもかなり良い。ライフタイムや所有権とかはまだいまいち慣れてません。隙あらば `.clone()` とかは大分減ったと思いますが、それでもうーんこれは `.clone()`！w みたいなことはたまにします。  \nそんな言語仕様にあまり詳しくない自分ぐらいの浅ちゃぷでも Web バックエンド作れるので、少しでも触ってみたい人がいたら触ってみてください。気持ちいいですよ！  \nこれから知識を付けていって、より Rust っぽいコードに変えていく作業が続いていくんだろうなと思うとそれも楽しそうです。  \n\nあとはガッと書き換える時のやりやすさですね。最初はめちゃくちゃエラーが出てキツってなるんですが、1個1個直してるとなんか勝手に動くようになってて、しかも動くことが保証されているかのような安心感があります。（実際殆ど問題なく動く）\n\n### これからの課題\n\n![Test Coverage](./static/test-coverage.png)\n\nテストがないんです・・・。（テストもなく〜とか言ってたのに結局ない）  \nなのでテストをモリモリ書いていこうと思います。でもテストなくてもロジックのバグくらいしかなかったのが凄いなと思いました。（それをテストでry）  \nまあ簡単な Web アプリですし CRUD が主なところもあると思いますが。  \nという感じでテストを書いていくぞとなっています。\n\nまた、[SeaORM](https://www.sea-ql.org/SeaORM/) の Relation 周りがまだ使いこなせてなくて結構ぐっちゃぐちゃなので、それも良い感じにどうにかしたいです。\n\n後はちゃんと Rust っぽいコードが書けるようになっていきたいですね。\n\n## おわり\n\nということで Rust でフルリプレイスした話を書いてみました。パフォーマンスとかコストとかをあんま考えずにできるのが個人開発の良いところですね。ただ、どう考えても構成がオーバースペックで高いな〜〜みたいな感じには思ってるので、そのうちコストを下げるための何かを考えるかもしれません。  \n個人開発は完全に自由なので最高ですね 🥳\n","slug":"smashfreaks-replace-with-rust","title":"WebサービスをRustでフルリプレイスした話","published":"2024-02-14","publishedIndex":0,"tags":["Rust","個人開発"],"fileName":"smashfreaks-replace-with-rust","staticFiles":["contribution.png","metrics.png","smashfreaks-aws.png","test-coverage.png"]},{"content":"\nせっかく[Mac Studio](https://www.apple.com/jp/mac-studio/)を購入したので、セットアップ周りをメモとして書いとく。ちなみにApple Silicon機は2台目なので初見ではないです。\n\n## ソフトウェア編\n\n### SSH鍵\n\nなんの鍵作っちゃおうかな〜〜と適当に調べていたらEdDSA鍵が出てきたので使うことにしました。\n[GitHubで使うSSH鍵を生成 - くたくたじゅうよん](https://scrapbox.io/takker/GitHub%E3%81%A7%E4%BD%BF%E3%81%86SSH%E9%8D%B5%E3%82%92%E7%94%9F%E6%88%90)を見てセットアップ。特にハマリポイントもなくすんなり。  \n\n### ブログ環境構築\n\n[このブログはNext.jsを使って作られている](/posts/create-a-blog)ので、Node.jsの環境が必要。  \nZennの[M1 Macのセットアップ・メモ](https://zenn.dev/catnose99/scraps/e1a2c41e9bf09c)を見てbrewからyarnまでセットアップしました。これも特にハマリポイントはなく、LTSのやつを選択して終わり。  \nちなみにanyenvを前は使っていた気がするけど、なんか遅いらしい（[anyenvが遅いので実行時間を計測して感謝しつつ卒業した - アルパカログ](https://alpacat.com/blog/bye-anyenv)）のでまあとりあえず使わなくていっかってなったので使ってません。  \n特に自分で計測とかはしておらず、不満に感じたこともないけど、anyenvがあったことによる恩恵を感じるほど触ったこともないのであった・・・。  \nあとは `git clone` して `yarn install` して `yarn dev` で動いていることを確認。\n\n### Androidアプリ開発環境構築\n\n[JetBrains Toolbox App](https://www.jetbrains.com/ja-jp/toolbox-app/)を入れてAndroid Studioをインストールして完了。\n\n### Docker Desktop\n\n昔はPreviewを入れないといけなかったけど、今はそのまま入れるだけでヨシ！  \n\u003chttps://www.docker.com/get-started/\u003e\n\n### Discord\n\nApple Silicon対応版はPTBかCanaryしか今のところないので、PTBを入れる。  \n\u003chttps://discord.com/download\u003eから「公開テスト版ビルドをダウンロード」。\n\n### ESET\n\n効果あるのか知らないけどESETというウイルス対策ソフトをとりあえず入れてます。（たまにこれが原因でローカルのvmへの接続が遮断されるとかがあったりなかったり？）  \n日本語版があるけど、同じライセンスを本家の英語版でも使えるので英語版を使ってます。日本語版は本家が何かしらの対応をした後、結構してから降ってくることが多いので。  \nApple Silicon対応した時やOSアップデート時とかにそうすることを決めました。  \n英語版はここから。  \n\u003chttps://www.eset.com/us/download/home/#mac\u003e\n\n### Dropbox\n\n入れるだけだった。今は自動的に判断するよ〜とのこと。[Dropbox による Apple シリコンのネイティブ サポート](https://help.dropbox.com/ja-jp/installs-integrations/apple-silicon-support)\n\n### Box\n\n[M1チップ搭載デバイスでのBox Driveのサポート](https://support.box.com/hc/ja/articles/1500004479962-M1%E3%83%81%E3%83%83%E3%83%97%E6%90%AD%E8%BC%89%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%A7%E3%81%AEBox-Drive%E3%81%AE%E3%82%B5%E3%83%9D%E3%83%BC%E3%83%88)より\n\n\u003e 重要: Box Driveの新しいバージョン (v.2.24.193) をリリースしました。このバージョンは、macOS 11.5以上でサポートされるAppleのFile Provider Extension (FPE) に基づいて構築されており、M1デバイスでのシームレスなアクセスとサポートを提供します。 このBox Driveの新しいバージョンは、こちらからダウンロードしてください。\n\nに従って\"こちら\"のリンクからダウンロードした。そしたら新しいバージョンのアップデートが降ってきていた。今はパブリックベータが終わっていて公式から安定版入れればそのまま対応版が入ってくれるのかもしれない。試してない。\n\n## ハードウェア編\n\n### Thunderboltドッキングステーション\n\n仕事ではMacBook Proを使っているので、差し替えるだけで良いという環境を作ることを目標にしています。  \n今までは[Amazon | Corsair TBT100 Thunderbolt3接続 PD対応](https://amzn.to/39hpVk9)を使っていました。仕事のMacBook Proにこれ1個だけ挿さっていた感じ。  \nこれがどうやらMac StudioのThunderboltポートではうまく動かない？らしく、モニターの認識がうまくいかなかった。  \n具体的には縦置きしているディスプレイは解像度がおかしくアスペクト比がおかしい。もう一つの普通の横モニターは色がおかしいって感じです。これはIntelのMacBook Proでは何も問題なく使えていたので、帯域とか相性みたいなハードの問題？とかなのかな〜と思ってます。  \n\nそこで今は[Amazon | Anker PowerExpand 5-in-1 Thunderbolt 4 Mini Dock ドッキングステーション 85W出力 8K対応 Thunderbolt 4 対応 USB-Cポート USB 3.1 Gen 2 USB-Aポート 搭載](https://amzn.to/3EKniTC)を使ってます。外部ディスプレイへの映像出力は[Amazon | Anker USB-C \u0026 HDMI ケーブル (1.8m ブラック)【4K 60Hz対応】MacBook Pro/MacBook Air (2020) / iPad Air 5 / Galaxy S20 / S10+ / S10 / S10e 、その他USB-C機器対応](https://amzn.to/3rTnn2a)を使っていて、USB Type-Aの接続には[Amazon | Transcend 6-in-1 USB 3.1 Gen 2 Type-C ハブ 【microSD(UHS-I),SDカード(UHS-II),Type-C (USB 3.1 Gen 2),Type-C (最大60W Power Delivery*充電専用),Type-A x2 (USB 3.1 Gen 1)】 TS-HUB5C](https://amzn.to/3EPSq4g)を使ってます。\n\n#### 映像出力おまけ\n\nディスプレイへの出力には今現在はモニターに直接挿していますが、ゲーム周りは[ATEM Mini](https://www.blackmagicdesign.com/jp/products/atemmini)で統一されています。これもその仲間に入れたいんですが、ATEM Miniに直接Macから出したHDMIを接続すると色がおかしくなります。「ATEM Mini mac 色」とかで検索するといっぱい出てきます。  \n改めて調べ直したところ[【色が変】Macの画面をATEM miniに入力すると画質が変わる問題｜doom｜note](https://note.com/ocdp10ply/n/n7b03157bbcbf)を見つけました。そこに書いてある[Amazon | 【国内正規品】Blackmagic Design コンバーター Micro Converter BiDirect SDI/HDMI 3G](https://amzn.to/3OELUli)を購入してみて間に挟んだところ、自分では気にならないくらいに改善したので最高となりました。\n\n### Magic Trackpad\n\nMac Studioはデスクトップなので入力関係も用意する必要があります。そして、クラムシェル運用のMacBook Proを利用する際に差し替えるだけで良い環境のためには、入力関係も統一したい感じがあります。  \nそこで[Magic Trackpad - ホワイト（Multi-Touch対応）](https://www.apple.com/jp/shop/product/MK2D3ZA/A/magic-trackpad-%E3%83%9B%E3%83%AF%E3%82%A4%E3%83%88multi-touch%E5%AF%BE%E5%BF%9C)を購入しました。  \nちなみにキーボードは[HHKB Hybrid](https://www.pfu.fujitsu.com/direct/hhkb/)を使っていて、これはBluetoothでマルチペアリング対応のため、最初から問題はなし。\n\nMagic Trackpadはマルチペアリングではないので、どれに接続するかはこちら側で何かしらの作業をする必要がありますが、Magic Trackpadは有線で接続すれば自動で接続先を変更してくれるため特に問題はなかったです。  \nThunderboltドッキングステーションからケーブルを伸ばしておいて、接続先変更をするときだけ繋ぐということにすれば問題解決！  \nおまけにMagic Trackpadの接続はLightningケーブルを使うため、iOSの開発をしたい時にiPhoneを接続するためのケーブルを用意することもできました。一石二鳥！\n\n## まとめ\n\n今は色々なものがそのまま入れるだけでApple Silicon対応になっていて嬉しみがあるなぁと思いました。  \nハードウェア周りはディスプレイの問題とかもあって結構厳しいな〜となりました。いい感じに解決はできたけど、お金はかかってしまった。まあ動いたのでヨシ！\n","slug":"setup-mac-studio","title":"Mac Studioを買ったのでセットアップした","published":"2022-05-04","publishedIndex":0,"tags":["Mac"],"fileName":"setup-mac-studio","staticFiles":[]},{"content":"\n[ブログに画像を貼れるようにした](/posts/add-images-to-my-blog) でブログに画像を貼れるようにしたけど、base64 で埋め込んでいたため少し問題があった。  \nそれを修正したのでこれも書いておく。\n\n## 何が問題だったのか\n\nbase64 で埋め込んでいるため、テキストデータの量が画像によって多くなってしまう。\n何が問題かと言うと、テキストデータを静的に HTML に入れているので、HTML ファイルの容量が大きくなってしまい、結果ページ読み込みの時間がかかるようになってしまっていた。  \n画像ファイルであれば非同期に読み込まれるっぽく、レンダリングをブロックすることがないっぽい。(正確には未指定で decoding=auto らしいから大体の最新ブラウザでは非同期で読み込まれる感じかな？ [\\\u003cimg\\\u003e: 画像埋め込み要素 - HTML: HyperText Markup Language | MDN](https://developer.mozilla.org/ja/docs/Web/HTML/Element/img#attr-decoding))\n\nまた、`yarn dev` でページを表示する度に容量大きすぎまっせ的な警告が出てしまう。（まあこれは鬱陶しいだけなので良し）\n\nじゃあ `/public` 配下に画像ファイル置いて普通に読み込めばいいじゃん？と思うが、書いてる最中（VSCode 上）や GitHub でプレビューして欲しかった。特に意味はないけどこだわりみたいなもの。  \nindex.md から画像への相対的な位置が違うので、どっちか（ビルド後の HTML と index.md）をうまくいかせようとするとどっちかが参照できないのであった。\n\n## どう直したか\n\n[画像を base64 で埋め込むやつじゃない感じにできないか考える · Issue #8 · Pon57/blog](https://github.com/Pon57/blog/issues/8)\n\nまず [remarkjs/remark-embed-images](https://github.com/remarkjs/remark-embed-images) から [remarkjs/remark-images](https://github.com/remarkjs/remark-images) に変えた。\n\nそして [Static HTML Export](https://nextjs.org/docs/advanced-features/static-html-export) 時に `/posts/blog/[slug]/static` フォルダにあるファイルを全て `/public/static` にコピーするようにした。\nつまり `/public/static/hoge.jpg` みたいなファイルが生える。\n同名のファイルがあった場合は後に同じ処理が走った時点で新しいファイルで上書きされそうな気がするけど、そこはまあ運用でカバーする。\n\n```ts\nconst copyStaticFiles = (slug: string, staticFiles: string[]) =\u003e {\n    staticFiles.forEach(staticFile =\u003e {\n        fs.mkdirSync(path.join(process.cwd(), 'public/posts/static'), { recursive: true })\n        fs.copyFileSync(\n            path.join(process.cwd(), 'posts/blog', slug, 'static', staticFile),\n            path.join(process.cwd(), 'public/posts/static', staticFile),\n        )\n    })\n}\n```\n\nこんな感じの関数を作って、これを `getStaticProps` の中で呼ぶようにした。  \n`staticFiles` は `/posts/[slug]/index.md` からブログのデータを取ってくるときに一緒に `/posts/[slug]/static` ディレクトリの中を見てファイル名を持ってきてる。  \nかなりのゴリ押し。もっといい書き方も普通にありそうだけど、一旦動けばいいでこんな感じにしちゃった。\nとりあえず動いたので :yoshi:\n\n`/posts/[slug]/index.md` からみた `static/hoge.jpg` は生成される HTML からみた `static/hoge.jpg` と同じなので、`index.md` 上のプレビューでも表示されるし、出力された HTML でも表示できる。  \n変更してみたら確かに読み込みが早くなった気がする。\n\nファイルを `/public` 配下に書き込んじゃえばいいんじゃんというのはこのブログを見ていて思った。なんでかそれまでは思いつかなかった。  \n[Next.js で OpenGraph 画像を自動生成する | so99ynoodles](https://so99ynoodles.com/blog/nextjs-create-og-image-automatically)\n","slug":"add-images-to-my-blog2","title":"ブログに画像を貼れるようにした〜その後〜","published":"2022-01-26","publishedIndex":0,"tags":["TypeScript","Next.js","Blog"],"fileName":"add-images-to-my-blog2","staticFiles":[]},{"content":"\n[DroidKaigi 2021](https://droidkaigi.jp/2021/)に参加したので忘れないうちに書いておこうと思います。\n業務では Android を主に書いていて、メインでガッツリ触っている技術のカンファレンスに参加するのは初めてになります。\n\n## DroidKaigi 2021とは\n\n\u003e DroidKaigiはエンジニアが主役のAndroidカンファレンスです。 Android技術情報の共有とコミュニケーションを目的に、2021年10月19日(火)、20日(水)、21日(木)の3日間開催します。\n\u003e\n\u003e 参照：[DroidKaigi 2021](https://droidkaigi.jp/2021/)\n\n## 特に自分に刺さったセッション\n\n- [タイムテーブル](https://droidkaigi.jp/2021/timetable)\n- [DroidKaigi 2021 - YouTube](https://www.youtube.com/playlist?list=PLaOdaBFokChwyYpRl3jkqjCC4I6Jmb5Jg) (全セッション動画のプレイリスト)\n- [DroidKaigi2021セッション資料まとめ - Qiita](https://qiita.com/yuukiw00w/items/85891d818d42df119355)\n\n平日開催なので仕事しながら聴いていました。裏で流していたので、基本的にどのセッションも音は聴いています。\nどれも面白かったですが、その中でも特に興味を持って聴いていたセッションを感想とともに書いておこうと思います。\n\n### プロダクトレベルで必要になる Jetpack Compose テクニック\n\n- \u003chttps://droidkaigi.jp/2021/timetable/276801?day=1\u003e\n- \u003chttps://youtu.be/_5vP-NIRUCM\u003e\n\n今まさに Jetpack Compose を利用したアプリを作ろう！となっているので、画面遷移関連や便利ライブラリ等は特に今欲しかったものだ！！となりました。というか発表内容の殆どが今欲しいものなのでは？という感じ。\n\nちょっと色が透明になったりタップを裏が拾ったりの罠？っぽい **公式に(あまり)書いていない Tips** は、知っていただけで実装時のハマりを減らせそうな感じで嬉しい情報でした。\n\nちなみに [DroidKaigi/conference-app-2021](https://github.com/DroidKaigi/conference-app-2021) を触っていて気になった挙動が、発表に出てきた「下にある要素がタップを拾わないようにしたい」にそっくりな事象だったので、直すか！と少しコードを触りました。\n`BackdropScaffold` っていうのを使っていて、うまいことぱっと解決はできなかった。撃沈。(なので [conference-app-2021#743](https://github.com/DroidKaigi/conference-app-2021/issues/743) を立てた)\n\n### Androidエンジニアが1人という不安と向き合う\n\n- \u003chttps://droidkaigi.jp/2021/timetable/277386?day=1\u003e\n- \u003chttps://youtu.be/5M0xJLdAcAE\u003e\n\n自分は2019年入社後2021年現在までチームで Android エンジニアが1人という環境にいます。業務も3年目になって不安を感じている真っ最中なので、これは絶対に聴こうと思っていました。\nスライドに書いてある「これまでに抱えてきた不安」は自分も本当にそう感じていて、うわ〜〜〜やっぱそれ悩むよね〜〜〜っていう感じでなんか面白かった。\n\n\u003e 優れたソースコードを読む\n\nこれは自分も実践することがありますが、OSS のものを読んでいてもふわ〜ってしてしまってイマイチ身が入らないなぁと思っていることが結構ありました。\n読むときのコツであげられている「読む目的を決める・スコープを絞って読む」はあまりやったことがなかったので今度やってみようかなと思います。\nまた、自分はコードから背景・意図を感じる(想像する)力が足りてないなと思うことが多々あるので、そこも意識的にやってみてもいいかなぁと考えてます。\n\n\u003e アーキテクチャに唯一の解はない\n\n分かってはいるけど、どうしてもそこら辺を考えると無限に悩んでしまう自分がいて、この作り方して負債になってないかな・・・とかはよく不安になりますね。自分もアーキテクチャの正しさに悩まされすぎないようになりたいなぁ。\n\n\u003e 1人という不安については、ある種チャンス\n\n最近はそこそこチャンスとして考えることができていて、自分にとっては挑戦的な技術選定とかをすることができているかも？\nただ、自己満足にだけはならないように気をつけないといけないな〜と思っています。\n\nキャリアに関しては、自分がやりたいことが見えていないっていうのがぴったり当てはまっていると思いました。そこは一度しっかり考えないといけないなと思います。\n\n自分にターゲットされているかのようなセッションで、聴けてめちゃ良かったです。\n\n### ★2.2のアプリがIn-App Review APIを導入して★4.2になるまで\n\n- \u003chttps://droidkaigi.jp/2021/timetable/277349?day=2\u003e\n- \u003chttps://youtu.be/PvAw4jNQc10\u003e\n\n現在業務でストアレビューを良くしようタスクに着手している最中で、過去に[In-App Review APIでAndroidアプリレビューがめちゃくちゃ改善した話｜neuet / チャリチャリ｜note](https://note.com/neuet/n/n7b6d1f340606)を読んでいたので、より詳しく聴きたいなと思っていました。\n\n\u003e レビューのしやすさは満足度と評価のギャップを埋める。\n\u003e それは満足度が上がるということではない。\n\u003e サービスの満足度とのギャップがあるかわからない場合はまず調査をして、サービス満足度が低いのであればサービスの品質改善が先。\n\n「わかる〜〜〜〜〜」っていうのと、「あ、そうだよね・・・」っていうのが同時にくる😇\n実は既に `In-App Review API` は使っていて、いまいちレビュー評価が上がらない状況でした。\n正直満足度に関しては不明なところが多いなと思っているので、この動画を一回チームに共有してみんなで考えてみようと思います。\n\n`In-App Review API` がいいよ！みんなとりあえず使っておくべき！みたいな感じではなく、しっかりと状況を分析した上で導き出した施策の一つが `In-App Review API` でしたという話で、 `In-App Review API` を 使う/使わない/使っている/使っていない に関わらずとてもいい話でした。\n\n### 触って学ぶAccessibility\n\n- \u003chttps://droidkaigi.jp/2021/timetable/276229?day=2\u003e\n- \u003chttps://youtu.be/Rch-Uqk8MkA\u003e\n\nお恥ずかしながら、自分は Accessibility を考えて実装したことが殆どありませんでした。存在は知っています。\n実際にやるべきこととかは特に分かっておらず、そもそもどういった方法で操作をしているのかもあまり知りませんでした。\n実際に触ってみて「こうなってるのか〜」とか、「自分も入力は音声入力を使うと思い込んでたなぁ」ってなりました。ほんの少ししか触ってないので、今度自分が触っているアプリもやってみようと思います。\nスキャンアプリに関してはスキャンかけてみたら結構提案が出てきたので、少しずつ対応していこうかなってなりました。\n\n実際の体験から入門することができてわかりやすくてよかったです。\n\n### 2021年こそアクセシビリティと向き合おう\n\n- \u003chttps://droidkaigi.jp/2021/timetable/276232?day=3\u003e\n- \u003chttps://www.youtube.com/watch?v=RfSqaGQTXOY\u003e\n\nボタンを正確に押せない・複雑な操作が難しいとかの視点は持てていなく、想像することもできていなかったです。今までだと、押せるか押せないか、見えるか見えないかくらいしか想像できていなく、ハッとしました。\nまた、「うるさい場所では何も聞こえない」や「その言語が堪能ではないのでトーストが消えるまでに読めない」等の状況的障害は、たしかに。と思いました。\n聴けたのは最初のところだけで実装のところはしっかり聞けなかったので、後日しっかり聴こうと思います。~~最初動画を60分で作っていたらしく？て完全版が出るらしいので楽しみ。~~\n40分だった。動画が公開されていたのでとりあえず更新。\n\n### いかにしてアプリの起動時間を改善するか\n\n- \u003chttps://droidkaigi.jp/2021/timetable/272862?day=3\u003e\n- \u003chttps://youtu.be/8z0fKUcC110\u003e\n\n今までパフォーマンスを特に意識した改善とかをやったことがなかったので、実際どういうふうにやっていくんだろうというのは興味がありました。\n\n\u003e 直感で決めてはいけない、計測より始めよ\n\n- ボトルネックを解消しないと意味がない\n- 修正コストと得られる効果を考えて、作業の優先順位を決めるべき\n- そもそも、認識していないボトルネックが存在するかもしれない\n\n確かに〜。\n実際に計測する方法もいくつかあげられていて、めちゃくちゃ参考になりました。\n\n\u003e XXXにアクセスすればみれるよ、は大体誰も見ない\n\nそれな！これは大体のことに言えそう。\n運用・監視に関してはパフォーマンス以外のことにも適用できそうみたいなことが多くて為になりました。\n\n### その他もろもろ\n\n[Inside Jetpack Compose](https://droidkaigi.jp/2021/timetable/277384?day=3)とか[原理から完全理解するDagger Hilt Migration](https://droidkaigi.jp/2021/timetable/275396?day=3)とかは面白そうだなってなっていましたが、ながら聴きでは自分に難しかった・・・後でゆっくり聴きなおそうかなと思います。\n英語のセッションに関しても基本的にﾜｶﾗﾝなので、これもまたゆっくり。\n\n考えてみれば印象に強く残っているのは、実際に自分が求めているものだったり近い業務に関係しそうなことばっかりだった。それはそう。\n\nただ、全く触ったことない分野？（[Jetpack ComposeとGraphQLによるServer Driven UI](https://droidkaigi.jp/2021/timetable/277015?day=3)とか[Android Emoji 2021](https://droidkaigi.jp/2021/timetable/277220?day=2)、[動かす](https://droidkaigi.jp/2021/timetable/277266?day=1)とか）をおもしろ〜いと深く考えることなく聴くのもやっぱり面白かった。\n[動かす](https://droidkaigi.jp/2021/timetable/277266?day=1)とかは発表資料がそもそも Android アプリだったりして、うお〜〜〜おもしろ〜〜いってなりました。\n(動かすの発表資料リポジトリ -\u003e [yaraki/AnimateIt](https://github.com/yaraki/AnimateIt))\n\n## セッションの内容以外の話\n\n### ノベルティ\n\nまずノベルティ。Tシャツは結構しっかりした生地で、普段使いにも全く困らなさそうなものでした。自分はトークの募集に応募していないので扇子はもらっていませんが、めちゃくちゃ**センス**がいいと思いました！！ピンバッジかわいい。\nスポンサーさんの選んだものも色々入っていて楽しいです。\n他カンファレンスでもスポンサーをしている企業も結構いてびっくりしました。\nカンファレンスのスポンサーをする等の技術コミュニティへの支援・貢献をしているのは素直にすごいな〜えらいな〜と思います。(偉そう)\n\n### 運営\n\nセッションのオフィスアワーに関しての質問を拾うのも人力でコメントや Twitter から拾っているのも大変だ〜ありがとうございます :pray: と思いますし、そもそもそれら含めた進行がすごい。MC （っていうんですかね？）も皆さん上手くてすごかったです。\n\nまた、マイクをスタッフの人やスピーカーの人に渡したりして、音質にも気を配ってくださっていたみたい。すごい。確かに音質の問題を感じることはあまりなかったように思いますね。\n\n最終日のうちにアーカイブが殆ど上がるのも嬉しい。その他自分の気が付かない範囲でも色々動いていたんだと思っています。ありがとうございます 🙏\n\n### 行動規範\n\nDroidKaigi に関しては行動規範の周知や遵守を徹底しているような感じがしていて、その内容も自分はすごく納得できるのでめちゃくちゃ良いと思いました。\n[一般社団法人DroidKaigi › 行動規範](https://association.droidkaigi.jp/code-of-conduct.html)\n内容はすごく納得できているので、自分も気をつけながらこの行動規範を遵守していければなと思います。DroidKaigi の場以外においても。\n\n## DroidKaigi公式フィードアプリ\n\nセッションの [DroidKaigiカンファレンスアプリの歴史からみるアプリアーキテクチャのこれまでとこれから](https://droidkaigi.jp/2021/timetable/277194?day=2) をみてもわかる通り、2016年からアプリが存在しています。（OSS 化したのは2017年〜らしい）\n\n今回自分は [DroidKaigi/conference-app-2021](https://github.com/DroidKaigi/conference-app-2021) に Contribute しました！\n\n\u003e いた！ [#DroidKaigi](https://twitter.com/hashtag/DroidKaigi?src=hash\u0026ref_src=twsrc%5Etfw) \u0026mdash; [ぽん (@pon_dev)](https://twitter.com/pon_dev/status/1450264713787371521?ref_src=twsrc%5Etfw)October 19, 2021\n\u003e ![contribute](./static/FCBf8W0UcAAvMIV.jpeg)\n\n[DroidKaigi/conference-app-2020](https://github.com/DroidKaigi/conference-app-2020) を何回も参考にしたので、ちょっとした変更ではありますがとても感慨深いです。\n自分がメインでキャリアを積んでいる技術の界隈に、このような場や機会が存在することはとても幸せだなと思いました。\n\n今回はカンファレンスのためだけのアプリじゃなく、ためになる情報とかも載ってるっぽい（今後載るっぽい）です。すごい！うれしい〜。\n(アプリの Google Play リンク → [DroidKaigi公式フィードアプリ](https://play.google.com/store/apps/details?id=io.github.droidkaigi.feeder))\n\n## 終わりに\n\nカンファレンスは何回か参加したことがありますが、全部そのときにはメインで触っていないこと（もしくはほぼ何もわからない）の状態の時しかなく、セッションを聴いてもへ〜〜〜くらいにしか思うことができませんでした。\n今回は初めてメインでそれなりに触っている技術のカンファレンスに参加して、それらとはまた別の種類の面白さも感じることができました。\n分かった上で聴いて考えるのも楽しいですね。\n\nとても楽しかったです。次回またあれば参加したいですね。\n関係者の皆様ありがとうございました〜！ :clap: :clap:\n","slug":"ididblog-droidkaigi2021","title":"DroidKaigi 2021に参加した話","published":"2021-10-22","publishedIndex":0,"tags":["Conference","Android"],"fileName":"ididblog-droidkaigi2021","staticFiles":["FCBf8W0UcAAvMIV.jpeg"]},{"content":"\n※追記：その後実装を変えました [ブログに画像を貼れるようにした〜その後〜](/posts/add-images-to-my-blog2)\n\n少しずつ弄ってるブログですが、この度画像を貼れるようにしました。\n\n[![サンプル画像](./static/james-harrison-vpOeXr5wmR4-unsplash.jpg)](https://unsplash.com/photos/vpOeXr5wmR4)\nｼﾞｬｰﾝ\n\nその時少しハマったので、ログを残しておきます。\n\n## 使おうとしたもの\n\n[remarkjs/remark-embed-images](https://github.com/remarkjs/remark-embed-images)\n\n## やったこと\n\n\u003chttps://github.com/Pon57/blog/commit/a74e1a337368daa3b692f78a9ae92f9b90b8881e\u003e\n\n## 引っかかったところ\n\n`gray-matter` でメタデータを解析したのち、コンテンツの文字列を抜き出して使っていた。\n\n```typescript\nconst post = ALL_POSTS.find(post =\u003e slug === post.slug) as Post\n\nconst processedContent = await unified()\n    .use(remarkParse)\n    .use(remarkEmoji)\n    .use(remarkBreaks)\n    .use(remarkExternalLinks)\n    .use(remark2rehype)\n    .use(rehypeHighlight)\n    .use(rehypeSlug)\n    .use(rehypeStringify)\n    .process(post.content)\n```\n\nこれにそのまま `.use(remarkEmbedImages)` を忍び込ませ、ブログ本文に画像を入れてみた。\nパスは `/posts/[slug]/hoge.png` という感じ。マークダウンファイルのパスはその当時は `/posts/[slug].md`\n\nだけどどうもうまくいかなかったみたい。\n\n\u003e TypeError [ERR_INVALID_ARG_TYPE]: The \"path\" argument must be of type string. Received type undefined\n\n試しに絶対パスを入れたけど、画像の変換が行われず、固定文字列が入っちゃった。\nプロジェクトルートから考えた相対パスを入れれば問題なく動いたけど、マークダウンファイルとの相対的な位置が合わず、プレビューもできないし嫌だな〜ということでボツ。\n\n## 解決のためにやったこと\n\n出ている場所は `remarkEmbedImages` で間違いないが、なんのこっちゃという感じ。\n\nエラーが示していた場所はここ。\n\u003chttps://github.com/remarkjs/remark-embed-images/blob/main/index.js#L27\u003e\n\n入れている `path` が関係あるのかと思いきや、`path` の引数が `undefined` の場合もこういうエラーが出るらしい。（※追記：エラー文に書いてあるじゃん！）\nVSCode で特に何もせず使えたデバッガーを利用して変数の中身を見てみると、どうやら `file.dirname` が原因だろうというところまでわかった。\n\nじゃあ `file` はなんなの？となるけど、コードを見てもいまいち分からず・・・\n\nなんか検索しているうちに再実装しているリポジトリを見つけた。\n\u003chttps://github.com/ahlec/jyosuushi/blob/0990e7c75c2df7c704acb9bcaca23bf999b3d181/scripts/markdown/parsing/embeded-images.ts\u003e\n\nそんなこんなしているうちに `file.dirname` に `posts` という固定文字列を入れてみた。動いた！\nこの時世界が動き出した。\n\nなんでか覚えてないけど `.process()` には `vfile` を入れることができるということを知り、`vfile` は `dirname` や `path`、`cwd` があり、なんかみたことのあるな〜という感じ。\n\u003chttps://github.com/vfile/vfile\u003e\n\nそうか、`remark-embed-images` の `file` は `vfile` のことだったのか・・・となった（どうして `vfile` なのかはまだ分かってない）\n\n```diff\nconst post = ALL_POSTS.find(post =\u003e slug === post.slug) as Post\n+ const file = toVFile({ value: post.content, path: process.cwd(), dirname: 'posts' })\n\nconst processedContent = await unified()\n    .use(remarkParse)\n...\n    .use(rehypeStringify)\n-   .process(post)\n+   .process(file)\n```\n\nとしたら無事動いた :tada:\n\n## おわり\n\nなんで動いたのかとかあんまりよく分かっていないけど、文字列を `.process()` に入れるとファイルの中身だけはあるけど実体は無いみたいな扱いをされて、その結果 `dirname` が `undefined` になっていたとかそんな感じかなぁって思ってる。\nそのうち気が向いたら追ってみると思う。\n\nとりあえず動くようになったのでよかった :kissing_closed_eyes:\n","slug":"add-images-to-my-blog","title":"ブログに画像を貼れるようにした","published":"2021-10-14","publishedIndex":1,"tags":["TypeScript","Next.js","Blog"],"fileName":"add-images-to-my-blog","staticFiles":["james-harrison-vpOeXr5wmR4-unsplash.jpg"]},{"content":"\n日記テスト\n日記を実装した日\n","slug":"2021-10-14","title":"2021年10月14日","published":"2021-10-14","publishedIndex":0,"fileName":"2021-10-14","staticFiles":[]},{"content":"\n初の iOSDC Japan 参加記であり、初のカンファレンス参加記です。 :tada: [iOSDC Japan 2021](https://iosdc.jp/2021/)\niOSDC Japan に関しては 2020 から参加しており、主催（実行委員長？）の方が同じ PHPerKaigi では 2019 から毎年参加しています。\nいつも iwillblog を無視し続けている感じになっていたので、今回こそは！！！という感じです。\n\nということで書く為にこのブログを[作りました](/posts/create-a-blog)。作り始めたのは iOSDC Japan 2021 最終日の最中です。（急にモチベが湧いた）\n無事にできたので書いていこうと思います。\n\nこういうものを書き慣れていないのに加え、クオリティよりも \"まず書くこと\" に重きを置いてるので、見にくさ等あったらすみません！\n見る人がいるのかというのはありますが、そこは自己満足ということで・・・（というかブログ自体も未完成だし）\n\n## iOSDC Japan 2021 に参加した理由\n\n自分の仕事はエンジニアで、主に Android アプリを書いています。たまに Swift のコードを見ることもありますが、殆ど知識もなく初心者です。\n\nそんな自分が参加する理由はいくつかあります。\n\n- 単純に技術系のお話を聴くのが好き\n- Android エンジニアとして、他プラットフォームの動向を知る良い機会\n- 最近友人が iOS アプリ制作の勉強を始め、自分もちょくちょく関わっている\n- iOS について別に分からなくても為になるようなトークもある\n- 運営に一定の信頼がある\n  - 楽しめそうという意味\n- オンラインなので気軽に参加できる\n\nこれらです。\n\n## 今回聴いたセッション\n\n- [タイムテーブル](https://fortee.jp/iosdc-japan-2021/timetable)\n- 資料探しはここにまとまっていてよかったです。\n  - [iOSDC 2021セッション資料まとめ - Qiita](https://qiita.com/yuukiw00w/items/4682a7dacb480078047a)\n\n今回は友人と Discord を繋ぎながらそれぞれが興味のあるものを聴きました。\n\n### day0\n\n- [大規模リファクタリングの極意](https://fortee.jp/iosdc-japan-2021/proposal/589c4329-022b-47c9-b8ea-b913eacf831b)(Track A)\n- [SwiftUIで使ったアプリを1年運用してみてわかったこと](https://fortee.jp/iosdc-japan-2021/proposal/c7021c6b-2732-4a20-9f8a-a82d53e89526)(Track A)\n- [Initiatives in Rakuma iOS App](https://fortee.jp/iosdc-japan-2021/proposal/e783c261-1c2b-4f31-854d-7c1575d73656)(Track A)\n- [SwiftUI で実プロダクトを音速リリースした話](https://fortee.jp/iosdc-japan-2021/proposal/87be2f57-5dca-4263-9b43-55b8d02e9c17)(Track A)\n- Today's Update （10分）\n\n### day1\n\n- オープニング （40分）\n- [とあるアプリのサービス終了を見届ける 〜サブスクリプション型アプリのサービス終了ベストプラクティス〜](https://fortee.jp/iosdc-japan-2021/proposal/4003bc8c-59f9-4915-a3d3-b307a133bae2)(Track A)\n- [日本語でもいい感じに改行したい！！](https://fortee.jp/iosdc-japan-2021/proposal/65844bb5-af6f-4ca8-b1ce-8dca518f821a)(Track B)\n\n「日本語でもいい感じに改行したい！！」をベッドで寝転がりながら見ていたら寝落ちしました。起きたのは翌日3時・・・なのでこの日のリアルタイム視聴はほぼ全滅ですw\n\n### day2(最終日)\n\n- Today's Update （10分）\n- [ランタイムデバッグのススメ](https://fortee.jp/iosdc-japan-2021/proposal/d178e3bb-e2fe-4ccd-8a99-d53951468ce1)(Track A)\n- [大規模なアプリのマルチモジュール構成の実践](https://fortee.jp/iosdc-japan-2021/proposal/1b05a1c0-91ef-401a-b3f3-36f0e57a6a25)(Track A)\n- [KMMを使って感じたPros/Cons](https://fortee.jp/iosdc-japan-2021/proposal/376c90d9-18e2-4563-9829-34801cfe95ae)(Track B)\n- [LINEアプリのモバイル体験改善に向けた取り組み iOSDC](https://fortee.jp/iosdc-japan-2021/proposal/0fef5057-99b7-4fdc-8c8c-d05e9818ca37)(Track C)\n- [WidgetKitで良い体験を作るには](https://fortee.jp/iosdc-japan-2021/proposal/37c0a8f3-58cc-424a-a32b-ba136c93aac2)(Track C)\n- [hak \u0026 tomzoh 特別企画](https://fortee.jp/iosdc-japan-2021/proposal/c9fbfab9-d19f-4c80-b9f3-b00ef628c16c)(Track E)\n- [ほんの一瞬だけでもConcurrencyの計算理論に触れてみませんか？](https://fortee.jp/iosdc-japan-2021/proposal/1ee9231b-b630-4838-a965-0e308a3429b8)(LT)\n- [NDIとARKitを連動させた新しい映像表現](https://fortee.jp/iosdc-japan-2021/proposal/8e72bf07-f6ca-42cb-b6cc-ef649efd5950)(LT)\n- [Swiftのソートアルゴリズムの特徴を5分できちんと知る](https://fortee.jp/iosdc-japan-2021/proposal/26d98ba7-de97-42ac-9763-1d4137e287ef)(LT)\n- [Using Eigen from Swift (via C)](https://fortee.jp/iosdc-japan-2021/proposal/df47003d-68c2-45a1-ba1d-f8d5a400f4cd)(LT)\n- [5分でわかるIDFA / ATT](https://fortee.jp/iosdc-japan-2021/proposal/7b25b0ec-5e0c-493f-8d87-9c83031d33c8)(LT)\n- [アプリの終活](https://fortee.jp/iosdc-japan-2021/proposal/a77ea2d7-283d-433d-a201-3867c8f6a01d)(LT)\n- [今、改めて振りたいiPhone搭載のセンサとその使い道](https://fortee.jp/iosdc-japan-2021/proposal/b6878124-3280-4ed5-87bf-091d6be57202)(LT)\n- [Kyash iOSアプリのQAの歴史](https://fortee.jp/iosdc-japan-2021/proposal/32529829-3973-464b-9f92-248cdb5538f8)(LT)\n- [Hey Siri！マルチプラットフォームでのSiriショートカットの地雷を教えて](https://fortee.jp/iosdc-japan-2021/proposal/e97fb3e3-26fd-42eb-ab8b-cf6bee2dd41f)(LT)\n- [２段階認証実装の勘所](https://fortee.jp/iosdc-japan-2021/proposal/9d436faa-9d45-4f50-bf33-969240f1dd9e)(LT)\n- クロージング （30分）\n\n### タイムシフト視聴\n\nオンラインはタイムシフトがあるので助かります。自分はニコニコ動画のプレミアム会員なので、タイムシフト予約無しで1ヶ月間見放題！\n\n- [iOS・Androidで使えるデザインシステムをどう実装するか](https://fortee.jp/iosdc-japan-2021/proposal/ddb7719b-3440-46ee-8a58-0d8a163bc6f8)(day0 Track C)\n- [実践 iOS オープンソースプロジェクトの始め方](https://fortee.jp/iosdc-japan-2021/proposal/5a93e99d-159a-4fde-aab8-5ca14ed4ae76)(day1 Track A)\n- [宣言的UIの状態管理とアーキテクチャ - SwiftUIとGraphQLによる実践](https://fortee.jp/iosdc-japan-2021/proposal/a85bf338-ae84-4ad0-ab12-8c02afc6e40c)(day1 Track B)\n- [機能ごとに動作するミニアプリでプレビューサイクルを爆速にした話](https://fortee.jp/iosdc-japan-2021/proposal/6b6fb68b-a45a-4878-a8b9-0dd5ed90fc39)(day1 Track C)\n- [歴史のある大規模アプリに Design System を導入して開発をスケールさせる](https://fortee.jp/iosdc-japan-2021/proposal/be2d5c5b-aaf4-475e-8c76-b68d589ffb6f)(day1 Track C)\n- [僕たちが『Appのプライバシーに関する質問への回答』そして『ATT』に対応するまでの物語](https://fortee.jp/iosdc-japan-2021/proposal/cb27f5b5-dd66-47ee-a224-afcc97d979b6)(day1 Track D)\n- [iOSエンジニアがKMPで大規模アプリのロジック共通化をしてうまくできている話](https://fortee.jp/iosdc-japan-2021/proposal/6d170404-d2b6-4379-ad9e-19e304eb7a31)(day1 Track D)\n- [UITestを活用しまだまだ不安定なSwiftUIアプリを安定的に実務運用する方法](https://fortee.jp/iosdc-japan-2021/proposal/72a9c9f1-7440-40a6-84c1-37102909d045)(day1 Track E)\n- [iOSアプリのセキュリティ基礎](https://fortee.jp/iosdc-japan-2021/proposal/f4eeade3-e50b-4a49-91dc-22bbba321ecb)(day2 Track A)\n- [オフライン編集もできる複雑なデータ構造を端末間で同期するために](https://fortee.jp/iosdc-japan-2021/proposal/de41bc2f-f910-46ee-be0d-1d7dedb89649)(day2 Track D)\n- [元ゲーム開発者が贈る描画パフォーマンス改善](https://fortee.jp/iosdc-japan-2021/proposal/ddf82e43-3c73-43ee-b647-bed6ac48c834)(day2 Track E)\n\n(まだ増えるかも)\n\n### 感想\n\n設計の話や運用の話は特に自分の業務にも直結することが聴けたのでよかったです。ただ直結しないものでも聴くのは単純に楽しいです。iOS に関してほぼ分からなくても楽しめました。\n\n感想は個別に書こうと思ってたんですが、後からまとめて書いたら力尽きたので、今度は感想が生のうちにその場でパッと書いちゃうのがいいな・・・と思いました。\n次からはそうしてみます。\n\nどれも面白かったですが、特に\n\n- 大規模リファクタリングの極意\n- iOSアプリのセキュリティ基礎\n- 機能ごとに動作するミニアプリでプレビューサイクルを爆速にした話\n\nとかは自分にとってもすぐに持ち帰りできる内容かなと思いました。\n\n## セッション以外\n\n### パンフレット\n\n本当に読んでいて楽しいです。自分は雑誌系を読むのが好きで、子供の頃ゲームの雑誌をよく読んでいました。その時に感じていたワクワク感に似たものを感じます。しばらくは何回も見直す感じになるかなと思います。\nトークン（後述）も隠されていたりするところがあり「おっトークンだ」という楽しみ方もできました。電子版パンフレット限定のトークンもあるらしく、ほ〜となりました。\n\n### ノベルティ\n\nノベルティボックスは毎回開けるのが楽しみです！今回スポンサーが多い？ような気がしました。（比べてません）\n今回は実用的なもの for me が多かったのでめちゃくちゃ助かってます :laughing:\nありがとうございます :pray: :pray:\n\nノベルティにもスポンサーの色が出ていてかなり面白かったです。ノベルティの後日談というか準備の裏話とかを見るのも結構好きでした。\n\n- [iOSDC Japan 2021 ノベルティうらばなし](https://note.com/huin/n/nd824f3fa586d)\n- [iOSDC Japan 2021 で色々とノベルティを作ったよ #iosdc - hamacoの日記](https://hamaco.hatenablog.jp/entry/2021/09/16/114924)\n\nとかとか。\n\nどういうものが入っているのか気になった方はこちらにまとまっていたので良ければ。\n[iOSDC Japan 2021のノベルティが届いたので大公開 #iosdc｜かっくん / iOS Developer](https://fromkk.me/n/n2ee727553744)\n\n### アンカンファレンス\n\nアンカンファレンスには今まで一度も参加できていません。\n枠を取り〜というシステムは結構好きで、トークの録画システムもそうですが、オンラインでうまいことやったな〜〜すごいな〜〜と思います。\n\n### トークンチャレンジ\n\niOSDC Japan には # で始まるトークンを入力してポイントを競い合うというイベントがあります。\n詳しくはスタッフブログの記事を見てください。\n[iOSDCチャレンジの受付がスタートしました! – iOSDC Japan スタッフブログ](https://blog.iosdc.jp/2021/09/17/iosdc%E3%83%81%E3%83%A3%E3%83%AC%E3%83%B3%E3%82%B8%E3%81%AE%E5%8F%97%E4%BB%98%E3%81%8C%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%88%E3%81%97%E3%81%BE%E3%81%97%E3%81%9F/)\n\n自分は今回ちょっと余裕なさげだったのでトークン探しは最初からしないと決めていました。このような選択ができるのも良いところだと思います。（勿論参加にインセンティブがあるところも）\n今回は終わってみれば「参加してもよかったな・・・」という感じなっています・・・ :sweat_smile:\n\nPHPerKaigi でも同イベントはありましたが、かなり良いイベントだと思います。トークンはスポンサーのブログ等にも結構あるので、それらを読む・見る機会を作り出すという、なんというかいい感じだ〜と感じるところが好きです。余裕ができた時にまたあれば参加予定です！\n\nトークンに関してだけではないですが、イベントの為にシステムを作り、リアルタイム感で改善がなされていく様は感動とモチベをもらえます。\n\n### Ask the Speaker\n\n今回初めて参加してみました。（聴き専）\n自分は質問が苦手（すぐ思いつかない）なので参加を控えていたのですが、今回参加してみて他の方が質問した内容を回答含め聴いているだけでもかなり面白いなと思いました。\nもっとも、この使い方が想定されているのかは分からないですが・・・\n\n自分では思いつかなかった視点から話が広がっていて結構面白かったです。\n\n## 終わり\n\n今回も見ているだけですが大満足でした。何よりこういうカンファレンスとかって終了後に妙に色々な事に対するモチベが上がるのがいいんですよね。それだけでも定期的に参加する価値がある気がします。\n今回もちょっとしんどくなりかけていたタイミングだったので、絶妙に回復できました。\n\n次回はオフラインかもということで、友人とオフライン行きたいな〜とか話をしていました。\niOSDC Japan はオフラインで参加したことがないので楽しみにしています。（もちろんオンラインでも！）\n関係者の皆様ありがとうございました〜！ :clap: :clap:\n\niOSDC Japan では無いかもですが、自分も登壇とかしてみたいな〜。\n\n## おまけ\n\n- パタヘネの本を買いました。ちょこちょこ読んでいきます。\n","slug":"ididblog-iosdcjapan2021","title":"iOSDC Japan 2021に参加した話","published":"2021-09-21","publishedIndex":1,"tags":["Conference","iOS"],"fileName":"ididblog-iosdcjapan2021","staticFiles":[]},{"content":"\nこの前 [iOSDC Japan 2021](https://iosdc.jp/2021/) というカンファレンスに参加しました。そこで出てくるキーワードとして「iwillblog」というものがあります。\n意味は見ての通りで「私はブログを書きます」で、それを見るたびに書くか！と思いますが、今まで書いたことがありません。\n同じようなカンファレンスは何度か参加していますが、毎回そんな感じです。\n\n個人的に書くモチベがある場所があまりなく、書きたいなと思っているうちに月日が流れ・・・。という感じ。\n一応はてなブログにもブログを持ってはいますが、いまいち続かず放置になっていました。\n\n\u003e PHPerKaigi のブログを作るためにブログを作るか・・・\u0026mdash; [ぽん (@pon_dev)](https://twitter.com/pon_dev/status/1376106858126008331?ref_src=twsrc%5Etfw)March 28, 2021\n\nMarch 28, 2021 はい・・・\n\nしかし今回に限ってはいつもと違い、書くに至っています。\n\n- いつも通りブログを書こうと思った\n- フロントちょっとずつ触っていきたかった\n- 作った方が愛着が湧きそう\n  - せっかくなら作ってみたい\n\nという感じがあったので、ブログを作ってその流れで書いちゃえばいいんじゃね？という感じになりました。\n\n## 何でできてるの\n\nNext.js で Markdown を読んで GitHub Actions で SSG して GitHub Pages で配信という形を取りました。（他のサービスを使うのが何となく面倒くさかったので GitHub で完結するようにしました）\n\nソースコードは \u003chttps://github.com/Pon57/blog\u003e にあります。\n\nフロントほぼ何もわからないという状態なので、「nextjs ブログ」みたいな感じで調べて出来そうなものをピックアップし写経するという形を取りました。\nみたのは [Next.js + TypeScript + VercelでJamstackなブログを作る その1 - 環境構築/記事の作成・表示](https://blog.zenpachi.dev/posts/nextjs-blog/) です :pray:\n\nそのままでは動かないところは都度調べて少し変えるという感じで、とりあえず動くものが出来ました。変えたところが正しいかはわからないですが、動いているのでヨシ！\n\n公式もかなりいい感じのチュートリアルがあるっぽいので、それも今度みてみようと思います。\n\n## これから\n\n写経から少しカスタマイズをしていますが、本当に何もない状態なので、少しずつレイアウト作ったり機能作ったりしていければいいかな〜と思ってます。\nタグとかそのうち入れたい。\n\nそれでは(・。・)ノシ\n","slug":"create-a-blog","title":"ブログを作った話","published":"2021-09-21","publishedIndex":0,"tags":["TypeScript","Next.js","Blog"],"fileName":"create-a-blog","staticFiles":[]},{"content":"\n内容はないよう\n","slug":"hello-world","title":"Hello World!","published":"2021-09-19","publishedIndex":0,"tags":["test"],"fileName":"hello-world","staticFiles":[]}]},"__N_SSG":true},"page":"/posts","query":{},"buildId":"n_dcOhZLlT1CFj-HBNtKQ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>